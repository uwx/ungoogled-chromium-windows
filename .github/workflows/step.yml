name: Step

on:
  workflow_call:
    inputs:
      finished:
        required: true
        type: boolean
      first:
        required: false
        default: false
        type: boolean
      x86:
        required: false
        default: false
        type: boolean
      num:
        required: false
        default: -1
        type: number
    outputs:
      finished:
        value: ${{ jobs.reusable_workflow_job.outputs.finished }}

jobs:
  reusable_workflow_job:
    name: ${{ inputs.x86 && 'x86 build' || 'x64 build' }}, step ${{ inputs.num }}
    runs-on: windows-2019
    steps:
      - name: Checkout
        if: '!inputs.finished'
        uses: actions/checkout@v3
        with:
          submodules: 'recursive'
      - name: Init
        if: '!inputs.finished'
        run: Copy-Item -Path . -Destination "C:\ungoogled-chromium-windows" -Recurse
      - name: Setup Stage
        if: '!inputs.finished'
        run: npm install
        working-directory: ./.github/actions/stage
      - name: Run Stage
        if: '!inputs.finished'
        id: stage
        uses: ./.github/actions/stage
        with:
          finished: ${{ inputs.finished }}
          from_artifact: ${{ !inputs.first }}
          x86: ${{ inputs.x86 }}
    outputs:
      finished: ${{ inputs.finished || steps.stage.outputs.finished }}