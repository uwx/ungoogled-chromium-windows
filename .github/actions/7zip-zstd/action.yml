name: Install 7zip-zstd codecs
description: Installs 7zip-zstd codecs
inputs:
  version:
    description: Version of 7zip-zstd codecs to install
    required: false
    default: 22.01-v1.5.5-R3
runs:
  using: composite
  steps:
    - if: runner.os != 'Windows'
      shell: bash
      working-directory: ${{ runner.temp }}
      run: |
        aria2c -x 16 "https://github.com/p7zip-project/p7zip/releases/download/v17.05/linux-cmake-p7zip.7z"
        7z x "linux-cmake-p7zip.7z" -op7zip
        sudo mv ./p7zip/* /opt/p7z
        sudo mv /opt/p7z/7z_ /opt/p7z/7z
        rm -r p7zip linux-cmake-p7zip.7z
        echo "/opt/p7z" >> $GITHUB_PATH

    - if: runner.os == 'Windows'
      shell: pwsh
      working-directory: ${{ runner.temp }}
      run: |
        aria2c -x 16 "https://github.com/mcmilk/7-Zip-zstd/releases/download/v${{ inputs.version }}/Codecs-x64.7z"

        $spliter = "path to executable:"
        $7zLocation = "$(Split-Path -parent ((7z --shimgen-noop | Select-String $spliter) -split $spliter | ForEach-Object Trim)[1])"
        $installLocation = "$(Join-Path $7zLocation "Codecs")"

        echo $installLocation

        7z x Codecs-x64.7z "-o$installLocation"
        rm Codecs-x64.7z

    - shell: pwsh
      run: 7z i